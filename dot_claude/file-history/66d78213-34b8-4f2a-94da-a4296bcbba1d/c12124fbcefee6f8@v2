import { clsx } from 'clsx';
import { useMemo } from 'react';
import { useCombinations } from '../hooks/useCombinations';

function addBodyShots(combo: string): string {
  return combo
    .split('-')
    .map((part) => {
      if (/^[1-6]$/.test(part) && Math.random() < 0.1) {
        return part + 'b';
      }
      return part;
    })
    .join('-');
}

export function CombinationPrompt() {
  const { currentCombo, isVisible } = useCombinations();

  const displayCombo = useMemo(() => {
    return currentCombo ? addBodyShots(currentCombo) : null;
  }, [currentCombo]);

  if (!displayCombo) return null;

  return (
    <div
      className={clsx(
        'fixed inset-0 flex items-center justify-center pointer-events-none z-50',
        'transition-opacity duration-300',
        isVisible ? 'opacity-100' : 'opacity-0'
      )}
    >
      <div
        className={clsx(
          'text-5xl sm:text-7xl font-bold text-white',
          'bg-black/60 px-8 py-6 rounded-2xl backdrop-blur-sm',
          'transform transition-transform duration-300',
          isVisible ? 'scale-100' : 'scale-90'
        )}
      >
        {displayCombo}
      </div>
    </div>
  );
}
